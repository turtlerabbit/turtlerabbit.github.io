---
title: FULL STACK WFP 03 - WPF in .NET and MVVM Navigation
date: '2021-05-12 03'
tag: WPF, FullStack, Navigation, MVVM
---
#
Simple Trader front-end를 위한 WPF project를 설정한다.  
MVVM 방식으로 프로젝트를 설정하고 매우 간단한 navigation control를 만들고 뷰 모델 간 탐색을 설정한다. 
#
### 1. WPF project 설정 및 MVVM 방식으로 프로젝트를 설정
* Add a new project : WPF Application - SimpleTrader.WPF
* 기본 설정
    1. Add Reference - SimpleTrader.Domain, SimpleTrader.EntityFrameworks
    2. 폴더 생성 - ViewModels, Views
    3. App.xaml - StartupUrl="MainWindow.xaml" line 삭제
    4. App.xaml.cs - 추가
    ```js
    protected override void OnStartup(StartupEventArgs e)
    {
        Window window = new MainWindow();        
        window.Show();

        base.OnStartup(e);
    }
    ```
    5. F5 실행 완료
* ViewModels / MainViewModel.cs
* ViewModels / ViewModelBase.cs
#
### 2. Control
* Simple Wire Frame 
![alt](https://lh3.googleusercontent.com/O-uRlqWtzwgvgR6KTQTvWB12dLcnprtXOZ9RpewO6Pc2PGmlIFvAXMHVyW-1tw1BpD0J9uuiYVOk4GOJ4o22MHC2l2XDvTWP3qBXfZ05d39oMr7XxHKwd4pydCDEzTj85Vc-JuaafEs28Fai8ismVpCURBLNTcyIxpNwdOrOH5CvzWlhRMFpHuvWd_ABD_SIaE5CoDmetrqkUE1idi7Qz2HWituNVxt9XzAUmyT8_e-PtJWjvsyA9VEgddOqNETKWQA4Yc0le3tsT793Mk9GfVgT1WAKVIaEe0VwO88vciTdFkye82k5865Afn6omRp-xEGwTyncXjxR8ZYFV3ceNCBUgpcEfRFp9U8tOfLCPtKzgUPoZ4tGrcFugyBtT5pIAM1GnOMAXAh0UPCGKLVb5qd_QyY9fDE2jbsyn9mc_0kK_gR1nrk5BaqQqaBob8sulxb7c8DzYue1y3LhTLZZbbfkdVLchqB0yIxItpqaHbRrSr5pfWj22glADxwweUy9LpXGlSZfBH7QH76IO_a1fR38VWz8mVTvKR-5of71aftwbUw8npzlq5OSUNCNcDePSKE851iujkJDE2noO8blB1qXsEM-YMsyFp6gDmQ9oqml4J3uKcxvNZoVVtZep8PrXpVG28vUlEcFaSXQC4XRpAGabKEB8Hhus3UeIFEmRvPBfYpXyTCEhWTX2pP9lmjwNXJn4Xd7S1wr3JcT-CQ-ZA=w1342-h603-no?authuser=0)
* 폴더 생성 - SimpleTrader.WPF / Controls
* Controls - NavigationBar.xaml (user control)
    - Navigation Bar 기능을 하는 user control
    ```js
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" 
                    Text="Simple Trader"/>
        <Grid Grid.Row="1" >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <RadioButton Grid.Column="0" />
            <RadioButton Grid.Column="1" />
            <RadioButton Grid.Column="2" Content="Buy" />
            <RadioButton Grid.Column="3" Content="Sell" />
        </Grid>
    </Grid>
    ```
* MainWindow.xaml
    ```js
    // MainWindow에 NavigationBar 연결

    xmlns:controls="clr-namespace:SimpleTrader.WPF.Controls"

    <Grid>
        <controls:NavigationBar/>
    </Grid>
    ```
#
### 3. Style
* 폴더 생성 - SimpleTrader.WPF / Styles 
* Styles / Common.xaml (Resource Dictionary)
    ```js
    <!--Colors-->
    <Color x:Key="ColorPrimary1">#799540</Color>
    <Color x:Key="ColorPrimary2">#50632b</Color>
    
    <!--Brushes-->
    <SolidColorBrush x:Key="BrushPrimary1" Color="{StaticResource ColorPrimary1}" />
    <SolidColorBrush x:Key="BrushPrimary2" Color="{StaticResource ColorPrimary2}" />
    ```
* App.xaml
    ```js
    // Application에 스타일 등록

    <Application.Resources>
        
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Common.xaml" />
            </ResourceDictionary.MergedDictionaries>
        
        </ResourceDictionary>

    </Application.Resources>
    ```
* Controls / NavigationBar.xaml
    ```js
    // 등록한 스타일 적용
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" 
                   Text="Simple Trader"
                   Background="{StaticResource BrushPrimary1}"/>
        <Grid Grid.Row="1" Background="{StaticResource BrushPrimary2}">

        ....

        </Grid>
    </Grid>
    ```
#
### 4. Setup navigation between view models
* ViewModels / HomeViewModel.cs
* ViewModels / PortfolioViewModel.cs
* 폴더 생성 - SimpleTrader.WPF / State 
* 폴더 생성 - SimpleTrader.WPF / State / Navigators
* / State / Navigators / INavigator.cs
    ```js
    public interface INavigator
    {
        ViewModelBase CurrentViewModel { get; set; }
        ICommand UpdateCurrentViewModelCommand { get; }
    }
    ```
* / State / Navigators / Navigator.cs
    ```js
    public class Navigator : INavigator
    {
        public ViewModelBase CurrentViewModel{ get; set; }

        public ICommand UpdateCurrentViewModelCommand => 
                            throw new NotImplementedException();       
    }
    ```
* 폴더 생성 - SimpleTrader.WPF / Commands
* Commands / UpdateCurrentViewModelCommand.cs
    ```js
    public class UpdateCurrentViewModelCommand : ICommand
    {
        public event EventHandler CanExecuteChanged;

        private INavigator _navigator;

        public UpdateCurrentViewModelCommand(INavigator navigator)
        {
            _navigator = navigator;
        }

        public bool CanExecute(object parameter)
        {
            return true;
        }

        public void Execute(object parameter)
        {
            if (parameter is ViewType)
            {
                ViewType viewType = (ViewType)parameter;
                switch (viewType)
                {
                    case ViewType.Home:
                        _navigator.CurrentViewModel = new HomeViewModel();
                        break;
                    case ViewType.Portfolio:
                        _navigator.CurrentViewModel = new PortfolioViewModel();
                        break;
                    default:
                        break;
                }
            }
        }
    }
    ```
* / State / Navigators / INavigator.cs
    ```js
    public enum ViewType
    {
        Home,
        Portfolio,
    }

    ....
    ```
* / State / Navigators / Navigator.cs
    ```js
    public class Navigator : INavigator
    {
        ....

        public ICommand UpdateCurrentViewModelCommand => 
                            new UpdateCurrentViewModelCommand(this);       
    }
    ```
* ViewModels / MainViewModel.cs
    ```js
    public class MainViewModel : ViewModelBase
    {
        public INavigator Navigator { get; set; } = new Navigator();
    }
    ```
* Controls / NavigationBar.xaml
    ```js
    // Binding Command

    xmlns:nav="clr-namespace:SimpleTrader.WPF.State.Navigators"

    ....

    <RadioButton Grid.Column="0" 
                    Content="Home" 
                    Command="{Binding UpdateCurrentViewModelCommand}" 
                    CommandParameter="{x:Static nav:ViewType.Home}" />
    <RadioButton Grid.Column="1" 
                    Content="Portfolio"
                    Command="{Binding UpdateCurrentViewModelCommand}" 
                    CommandParameter="{x:Static nav:ViewType.Portfolio}" />
    <RadioButton Grid.Column="2" Content="Buy" />
    <RadioButton Grid.Column="3" Content="Sell" />

    ....
    ```
* MainWindow.xaml
    ```js
    // MainWindow에 NavigationBar 연결

    xmlns:controls="clr-namespace:SimpleTrader.WPF.Controls"

    <Grid>
        <controls:NavigationBar Grid.Row="0" DataContext="{Binding Navigator}" />
    </Grid>
    ```
* App.xaml.cs
    ```js
    protected override void OnStartup(StartupEventArgs e)
    {
        ....

        window.DataContext = new MainViewModel();

        ....
    }
    ```
* MainWindow.xaml
    ```js
    // 라디오 버튼 클릭 시 뷰모델 바인딩

   <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <controls:NavigationBar Grid.Row="0" DataContext="{Binding Navigator}" />
        <ContentControl Grid.Row="1" Content="{Binding Navigator.CurrentViewModel}" />
    </Grid>
    ```
* / State / Navigators / Navigator.cs
    ```js
    // 클릭시 속성 변화를 위해 INotifyPropertyChanged을 적용

    public class Navigator : INavigator, INotifyPropertyChanged
    {
        private ViewModelBase _currentViewModel;
        public ViewModelBase CurrentViewModel
        {
            get
            {
                return _currentViewModel;
            }
            set
            {
                _currentViewModel = value;
                OnPropertyChanged(nameof(CurrentViewModel));
            }
        }
        
        public ICommand UpdateCurrentViewModelCommand => 
                            new UpdateCurrentViewModelCommand(this); 

        public event PropertyChangedEventHandler PropertyChanged;

        protected void OnPropertyChanged(string propertyName)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
    ```
* / Models / ObservableObject.cs
    ```js
    // INotifyPropertyChanged를 구현한 클래스 작성
    public class ObservableObject : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged;

        protected void OnPropertyChanged(string propertyName)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
    ```
* / State / Navigators / Navigator.cs
    ```js
    // INotifyPropertyChanged를 구현한 클래스를 상속

    public class Navigator : ObservableObject, INavigator
    {
        private ViewModelBase _currentViewModel;
        public ViewModelBase CurrentViewModel
        {
            get
            {
                return _currentViewModel;
            }
            set
            {
                _currentViewModel = value;
                OnPropertyChanged(nameof(CurrentViewModel));
            }
        }

        public ICommand UpdateCurrentViewModelCommand => 
                            new UpdateCurrentViewModelCommand(this);        
    }
    ```
* / Views / HomeView.xaml
    ```js
    <Grid>
        <TextBlock Text="Home" />
    </Grid>
    ```
* / Views / PortfolioView.xaml
    ```js
    <Grid>
        <TextBlock Text="Portfolio" />
    </Grid>
    ```
* App.xaml
    ```js
    // Application에 DataTemplate으로 뷰모델-뷰 등록

    xmlns:viewmodels="clr-namespace:SimpleTrader.WPF.ViewModels"
    xmlns:views="clr-namespace:SimpleTrader.WPF.Views"

    <Application.Resources>
        
        <ResourceDictionary>
            ....

            <DataTemplate DataType="{x:Type viewmodels:HomeViewModel}">
                <views:HomeView />
            </DataTemplate>
            <DataTemplate DataType="{x:Type viewmodels:PortfolioViewModel}">
                <views:PortfolioView />
            </DataTemplate>
        
        </ResourceDictionary>
        
    </Application.Resources>
    ```
* F5

