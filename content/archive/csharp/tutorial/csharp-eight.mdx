---
title: C# 8.0
date: '2021-01-09 04'
tag: csharp, C#, tutorial, 8.0, 
---

```js
// 인터페이스: 클래스에서 구현해야 하는 관련 기능 그룹에 대한 정의가 포함된 개념
public interface IEmployee
{
  public string Name { get; }
  public decimal Salary { get; }
  //[!] C# 8.0 Default interface members : 구현체를 넣어두다.
  public string Id { get => $"{Name}[{this.GetHashCode()}]"; }


}

// 클래스
public class Person
{
#nullable disable
  public string Name { get; set; }
#nullable enable
  public Person(string name) => Name = name;

  //[!]
  public string? FirstName { get; set; }
  public string? MiddleName { get; set; }
  public string?  LastName { get; set; }

  public Person(string first, string last)
  {
      FirstName = first;
      MiddleName = null;
      LastName = last;
  }

  public Person(string first, string middle, string last)
  {
      FirstName = first;
      MiddleName = middle;
      LastName = last;
  }

}

// 추상 클래스
public abstract class Employee : Person, IEmployee
{
  public Employee(string name, decimal salary) : base(name) => Salary = salary;
  public decimal Salary { get; protected set; }
}


// 추상 클래스를 상속받는 클래스
public class Professor : Employee
{
  public string Topic { get; }
  public Professor(string name, decimal salary, string topic) : base(name, salary) => Topic = topic;

  // TODO: Deconstruct() Method => C# 7.0 사용자 정의 타입 분해
  // 내가 만들어놓은 클래스 Name 속성과 Topic 속성을 밖같으로 넘길려고 할때
  public void Deconstruct(out string name, out string topic) => (name, topic) = (Name, Topic);

  //[?] Indices and ranges
  //public string Id => $"{Name}[{Topic[0..3]}]";
  public string Id => $"{Name}[{Topic[..3]}]~[{Topic[^1..^0]}]"; // ^ 끝에서 시작
}

public class Administrator : Employee
{
  public string Department { get; }
  public Administrator(string name, decimal salary, string department) : base(name, salary) => Department = department;
}

public static class Service
{
#nullable disable
  static Person[] people = null;
#nullable enable

  static Service()
  {
      //[?] Null Coalescing Assignment Operator: ??=  =>  people이 null이면 값을 대입하라.
      people ??= new Person[]
  {
      new Professor("Blackpink", 1_000, "Computer Sicence"),
      new Administrator("Jisoo", 2_000, "ABC"),
      new Professor("Risa", 1_000, "Computer Sicence"),
  };
  }

  public static IEnumerable<IEmployee> GetEmployees()
  {
      foreach (var person in people)
      {
          if (person is IEmployee employee)
          {
              yield return employee;
          }
      }
  }

  //[?] c# 8.0 비동기 스트림(Asynchronous streams)
  public static async IAsyncEnumerable<IEmployee> GetEmployeesAsync()
  {
      foreach (var person in people)
      {
          await Task.Delay(1000);
          if (person is IEmployee employee) yield return employee;
      }
  }
}

class Program
{
  static async Task Main(string[] args)
  {
      //[?] C# 8.0 - static Local Function
      static void Print(string message) => Console.WriteLine(message);

      //[A] 동기화
      foreach (var employee in Service.GetEmployees())
      {
          Print($"Name: {employee.Name}");
      }

      Print("=========================");

      foreach (var employee in Service.GetEmployees())
      {
          //[?] Pattern Matching: C# 7.0 Type Pattern
          if (employee is Administrator administrator && administrator.Department is "ABC")
          {
              Console.WriteLine($"Administrator: {administrator.Name}");
          }
      }

      Console.WriteLine("=========================");

      //[B] 비동기
      await foreach (var employee in Service.GetEmployeesAsync())
      {
          //[?] Pattern Matching: C# 8.0 Property Pattern, Var Pattern
          //if (employee is Professor professor && professor.Topic is "Computer Sicence")
          if (employee is Professor { Topic: "Computer Sicence", Name: var name } professor)
          {
              Console.WriteLine($"Professor: {name} ({professor.Id})");
          }
      }

      await foreach (var employee in Service.GetEmployeesAsync())
      {
          //[?] Pattern Matching: C# 8.0 Location Pattern : Deconstruct() 구현
          if (employee is Professor(var name, "Computer Sicence") professor)
          {
              Console.WriteLine($"Professor: {name} ({professor.Id})");
          }
      }

      //[?] C# 8.0 - Nullable Reference Type
      var red = new Person("지수", "김");
      var length = GetMiddleNameLength(red);
      Console.WriteLine(length); // 0

      //[?] Switch Expression: 특정한 개체에 대해서 패턴을 쉽게 찾아 올 수 있다.
      Console.WriteLine("=========================");

      await foreach (var employee in Service.GetEmployeesAsync())
      {
          Console.WriteLine(GetDetails(employee));
      }
      
      static string GetDetails(IEmployee person)
      {
          return person switch
          {
              Professor p when p.Salary > 1_000 => $"{p.Name} - {p.Topic} - Big Company",
              Professor p => $"{p.Name} - {p.Topic}",
              Administrator administrator => $"{administrator.Name} - {administrator.Department}",
              _ => $"Who are you?"
          };
      }
  }

  static int GetMiddleNameLength(Person? person)
  {
      //[?] is somthing
      if (person?.MiddleName is { } middle)
      {
          return middle.Length;
      }
      return 0; // is null
  }
}
```
#
[source](https://github.com/ledpink/CSharpVersion)