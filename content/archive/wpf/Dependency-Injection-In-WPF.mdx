---
title: How to implement Dependency Injection in WPF
date: '2021-04-17 01'
tag: DependencyInjection, DI, WPF
---
#
### 1. What is Dependency Injection?
* 종속성 주입은 IoC (Inversion of Control) 설계 원칙을 달성하고 객체 생성과 소비를 분리하는 데 도움이된다.  
* 종속성 주입 프레임 워크는 개체 생성, 개체 수명 유지 관리 및 런타임에 필요한 종속성 제공을 용이하게한다.

#
### 2. Implementing Dependency Injection in WPF application.
#### Step 1. Create the .NET Core WPF application.
* Select “Create a new project” from Get Started dialog
* Select the “WPF App (.NET Core)” project template, from the “Create a new project” dialog and click “Next“.
* Give a name to the project and click on the “Create” button. The project will be created and loaded into Visual Studio.
#

#### Step 2. Add the NuGet packages to the project.
* Microsoft.Extensions.DependencyInjection
* Microsoft.EntityFrameworkCore.Sqlite
#

#### Step 3. Create a Data Folder and add DBContext and Model classes.
```js
Employee.cs: 
//This is the class that will act as the model.

public class Employee
{
    public int Id { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
}
```
#
```js
EmployeeDbContext.cs: 
// This is the DbContext class (Database Context) 
// and will be used to register with the Dependency Injection Service Provider.

public class EmployeeDbContext : DbContext
{
    #region Contructor
    public EmployeeDbContext(DbContextOptions<EmployeeDbContext> options) : base(options)
    {
        Database.EnsureCreated();
    }
    #endregion

    #region Public properties
    public DbSet<Employee> Employee { get; set; }
    #endregion

    #region Overridden method
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Employee>().HasData(GetEmployees());
        base.OnModelCreating(modelBuilder);
    }
    #endregion

    #region Private method
    private List<Employee> GetEmployees()
    {
        return new List<Employee>
        {
            new Employee {Id = 100, FirstName ="John", LastName = "Doe"},
            new Employee {Id = 101, FirstName ="Nicole", LastName = "Martha"},
            new Employee {Id = 102, FirstName ="Steve", LastName = "Johnson"},
            new Employee {Id = 103, FirstName ="Thomas", LastName = "Bond"},
        };
    }
    #endregion
}
```

#
#### Step 4. Modify App.xaml.cs class
* 이 클래스에서는 private method ConfigureServices()를 생성했다. 
* ConfigureServices() 메서드에서는 EmployeeDbContext와 MainWindow 클래스의 인스턴스를 등록하여 필요할 때 종속성 프레임 워크에서 해당 인스턴스를 주입 할 수 있도록한다.
* 우리가 추가 한 다른 메서드는 OnStartup ()이고, 
* 여기서는 ServiceProvider에게 MainWindow 클래스의 인스턴스를 제공하도록 요청하고, 
* 그 후에 Show () 메서드를 호출하는 MainWindow를 표시합니다.
#
```js
App.xaml.cs

public partial class App : Application
{
    private ServiceProvider serviceProvider;
    public App()
    {
        ServiceCollection services = new ServiceCollection();
        ConfigureServices(services);
        serviceProvider = services.BuildServiceProvider();
    }
    private void ConfigureServices(ServiceCollection services)
    {
        services.AddDbContext<EmployeeDbContext>(options =>
        {
            options.UseSqlite("Data Source = Employee.db");
        });
        services.AddSingleton<MainWindow>();
    }
    private void OnStartup(object sender, StartupEventArgs e)
    {
        var mainWindow = serviceProvider.GetService<MainWindow>();
        mainWindow.Show();
    }
}
```

#
#### Step 5. Update the App.xaml
* 여기서 StartupUri를 제거하고 App.xaml.cs에서 만든 Startup 이벤트 처리기를 추가하면 MainWindow를 시작하는 데 도움이 된다.
#
```js
App.xaml

<Application x:Class="WpfAppDIDemoApplication.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:WpfAppDIDemoApplication"
             Startup="OnStartup">
    <Application.Resources>         
    </Application.Resources>
</Application>
```

#
#### Step 6. Add the following code in MainWindow.xaml Grid tag
* This code will create a DataGrid and help us to display the Employee table data on the User Interface.
#
```js
MainWindow.xaml

<Grid>
    <DataGrid Name="EmployeeDG" AutoGenerateColumns="False">
        <DataGrid.Columns>
            <DataGridTextColumn Header="Id" Binding="{Binding Id}"/>
            <DataGridTextColumn Header="First Name" Binding="{Binding FirstName}"/>
            <DataGridTextColumn Header="Last Name" Binding="{Binding LastName}"/>
        </DataGrid.Columns>
    </DataGrid>
  </Grid>
```

#
#### Step 7: Add the code in MainWindow.xaml.cs
* 여기서는 EmployeeDbContext 매개 변수(parameter)를 허용하도록 MainWindows 생성자를 수정했으며 
* 매개 변수는 응용 프로그램 런타임 중에 dependency framework에서 제공된다.
* GetEmployee()는 EmployeeDbContext 참조를 사용하여 데이터베이스에서 employees를 가져오고 DataGrid의 ItemSource 속성을 채운다. 
* 그러면 사용자 인터페이스에 데이터를 표시하는 데 도움이된다.
#
```js
MainWindow.xaml.cs

public partial class MainWindow : Window
{
    EmployeeDbContext dbContext;
    public MainWindow(EmployeeDbContext dbContext)
    {
        this.dbContext = dbContext;
        InitializeComponent();
        GetEmployees();
    }
    private void GetEmployees()
    {
        var employees = dbContext.Employee.ToList();
        EmployeeDG.ItemsSource = employees;
    }
}
```

#
#### Step 8: Execute the application.
* The output of the application will be as given in the snapshot.
![alt](https://executecommands.com/wp-content/uploads/2020/05/wpf_di_app_output.png)